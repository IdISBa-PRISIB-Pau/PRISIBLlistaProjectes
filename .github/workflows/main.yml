name: Removeemails

on: [push]

permissions:
  actions: read
  checks: read
  contents: write
  deployments: read
  issues: none
  discussions: none
  packages: none
  pages: none
  pull-requests: none
  repository-projects: none
  security-events: none
  statuses: read

jobs:
  pre-commit:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v3
    - uses: pre-commit/action@v3.0.1
    - name: Remove emails from README
      run: |
        python -c "
        import re
        with open('README.md', 'r+') as f:
            content = f.read()
            new_content = re.sub(r'\\S+@\\S+', '[removed]', content)
            if content != new_content:
                f.seek(0)
                f.write(new_content)
                f.truncate()
        "

    - name: Commit and push if it's necessary
      run: |
        git diff
        git config --global user.email "actions@github.com"
        git config --global user.name "GitHub Action"
        git commit -am "Remove emails from README" || exit 0
        git push
